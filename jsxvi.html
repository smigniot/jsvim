<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width" />
<link rel="stylesheet" type="text/css" href="zion.css"></link>
<script type="text/javascript" src="CustomElements.min.js">
</script>
<script type="text/javascript" src="terminal.js">
</script>
<script type="text/javascript" src="jsvim_term.js">
</script>
<script type='text/javascript'>

var rollingin = [];
function vim_charIn(c) {
    //console.log("vimcharin", c, String.fromCharCode(c));
    document.querySelector("zion-terminal").appendChild(
        document.createTextNode(String.fromCharCode(c)));

    rollingin.push(String.fromCharCode(c));
    if(rollingin.length > 32) {
        rollingin.splice(0,rollingin.length-32);
    }
    console.log("Chars", rollingin.join(""));

    /*
    var text = document.createTextNode(str);
    if(caret)  { term.insertBefore(text, caret);  }
    else       { term.appendChild(text);          }
    console.log("STDOUT", c, String.fromCharCode(c));
    */
}
var Module = {
    charIn: vim_charIn,
    preRun: [(function(){
        // init: function(input, output, error)
        FS.init(function() {
            //throw new Error("Input asked");
            return null;
        }, vim_charIn, function(c) {
            console.log("STDERR", c, String.fromCharCode(c));
        });
    })],
    postRun: [(function(){
        var debug = document.querySelector("debug");
        function mainloop() {
            Module.ccall("jsvim_main_loop");
            if(debug) { debug.textContent = new Date(); }
            setTimeout(mainloop, 50);
        }
        mainloop();
    })],
    print: (function(text) {
        console.log("STDOUT", text);
        if (arguments.length > 1)
            text = Array.prototype.slice.call(arguments).join(' ');
    }),
    printErr: (function(text) {
        console.log("STDERR", text);
        if (arguments.length > 1)
            text = Array.prototype.slice.call(arguments).join(' ');
    }),
    canvas: (function() {}),
    setStatus: function(text) {},
    totalDependencies: 0,
    monitorRunDependencies: function(left) {},
}
</script>
<script type="text/javascript" src="xvi.js">
</script>
<style type="text/css">
html,body { width:100%; height:100%; margin:0; padding:0; }
body { background: linear-gradient(#80acaf, #dbe6e8); }
</style>
</head>
<body>

<zion-terminal id="jsvim" tabindex="0"><zion-caret id="caret" style="position:absolute;"></zion-caret></zion-terminal>
<footer id="debug" style="position:fixed;bottom:0;right:0;"></footer>

</body>
</html>
